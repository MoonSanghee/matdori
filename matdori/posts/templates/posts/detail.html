{% extends 'base.html' %}
{% load django_bootstrap5 %}


{% block content %}
<div class="row">
  <div class="col-7">
    <h1 class="heart">{{ post.title }}</h1>
    <div>
      <span>리뷰</span>
      <span>{{ post.review_set.count }}</span>
      <i class="bi bi-balloon-heart"></i>
      <span id="like-count" class="mt-3">{{ post.like_user.count }}</span>
    </div>
    <div class="">
      {% if post.image %}
      <img src="{{ post.image.url }}" alt="{{ post.image }}">
      {% else %}
      <img src="https://img.apti.co.kr/aptHome/images/sub/album_noimg.gif" style="width: 720px; height: 480px;">
      {% endif %}
      <!-- 좋아요 -->
      {% if request.user.is_authenticated %}
      {% if request.user in post.like_user.all %}
      <i id="like-btn" data-post-id="{{ post.pk }}" class="bi bi-balloon-heart-fill fs-1"
        style="position: absolute;top: 12rem;left: 47%;"></i>
      {% else %}
      <i id="like-btn" data-post-id="{{ post.pk }}" class="bi bi-balloon-heart fs-1"
        style="position: absolute;top: 12rem;left: 47%;"></i>
      {% endif %}
      {% else %}
      <i class="bi bi-balloon-heart fs-1" style="position: absolute;top: 12rem;left: 47%;"></i>
      {% endif %}
      <!-- 글쓴이 정보 -->
      <div class="mt-3" style="display: flex;align-items: center;">
        {% if post.image %}
        <img src="{{ post.image.url }}" style="width: 120px; height: 120px; border-radius: 50%;">
        {% else %}
        <img src="https://i.esdrop.com/d/f/bvRLlOwptP/ioSr1p9iMx.jpg"
          style="width: 120px; height: 120px; border-radius: 50%;">
        {% endif %}
        <a class="fs-3 ms-3 text-decoration-none text-black" href="{% url 'accounts:detail' post.user.pk %}">{{
          post.user.nickname }}</a>
        <div>Follow</div>
      </div>
    </div>
  </div>
  <div class="col-5">
    <div class="text-end">
      <a class="my-3 mx-2 btn btn-primary" href="{% url 'posts:update' post.pk %}">가게 정보 수정</a>
      <a class="my-3 mx-2 btn btn-danger" href="{% url 'posts:delete' post.pk %}">삭제</a>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  const likeBtn = document.querySelector('#like-btn')
  likeBtn.addEventListener('click', function (event) {
    console.log(event.target.dataset)
    axios({
      method: 'get',
      url: `/posts/${event.target.dataset.postId}/likes/`
    })
      .then(response => {
        console.log(response)
        console.log(response.data)
        if (response.data.isLiked === true) {
          event.target.classList.add('bi-balloon-heart-fill')
          event.target.classList.remove('bi-balloon-heart')
        } else {
          event.target.classList.add('bi-balloon-heart')
          event.target.classList.remove('bi-balloon-heart-fill')
        }
        const likeCount = document.querySelector('#like-count')
        likeCount.innerText = response.data.likeCount
      })
  })
  // likeBtn.addEventListener('click', function (event) {
  //   console.log(event.target.dataset)
  //   axios({
  //     method : 'get',
  //     url: `/posts/${event.target.dataset.postId}/likes/`
  //   })
    // .then(response => {
    //   console.log(response)
    //   console.log(response.data)
    //   if (response.data.isLiked === true) {
    //     event.target.classList.add('bi-balloon-heart-fill')
    //     event.target.classList.remove('bi-balloon-heart')
    //   } else {
    //     event.target.classList.add('bi-balloon-heart')
    //     event.target.classList.remove('bi-balloon-heart-fill')
    //   }
    //   const likeCount = document.querySelector('#like-count')
    //   likeCount.innerText = response.data.likeCount
  //   })
  // })
</script>
{% endblock content %}